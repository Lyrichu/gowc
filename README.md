# gowc - Go 语言实现的高性能 Word Count 工具

`gowc` 是一个使用 Go 语言编写的命令行工具，它模仿了标准 Unix `wc` (word count) 命令的基本功能。它的设计重点在于性能，旨在尽可能快地统计文件或标准输入中的行数、单词数和字节数。

## 功能特性

*   统计行数 (`-l`)、单词数 (`-w`) 和字节数 (`-c`)。
*   可以读取一个或多个指定的文件。
*   如果未指定文件或文件名是 `-`，则从标准输入读取。
*   在处理多个文件时打印 `total` 汇总行。
*   如果没有提供特定标志 (如 `-l`, `-w`, `-c`)，则默认打印所有三种计数 (等同于 `-lwc`)。
*   输出格式模仿标准 `wc`，计数数字右对齐显示。
*   使用优化的 I/O 和计数逻辑以实现高性能。
*   正确处理 Unicode 空白字符以进行单词分隔。

## 核心设计与性能优化

开发过程中的主要目标是最大化性能，特别是对于大型输入。采用的关键技术包括：

1.  **带缓冲的 I/O (`bufio.ReaderSize`)**: `gowc` 并未逐字节读取或依赖默认缓冲，而是使用了 `bufio.NewReaderSize` 和一个显式定义的大缓冲区（例如 64KB）。这极大地减少了底层系统调用 (`read()`) 的次数，因为程序一次性从操作系统请求大块数据到缓冲区。
2.  **分块处理 (Chunk Processing)**: 核心计数逻辑将数据读入一个可重用的字节切片 (`[]byte`) 中。然后，它在*内存中*迭代这个切片来统计行数、单词数和字节数。这避免了为每个字节进行函数调用（如 `ReadByte()`）的开销，并允许编译器更好地优化紧凑高效的循环。
3.  **高效的计数逻辑**:
    *   **字节数 (Bytes)**: 简单地跟踪从输入源成功读取的字节数。
    *   **行数 (Lines)**: 仅在遇到换行符 (`\n`) 时高效地增加计数。
    *   **单词数 (Words)**: 实现了一个简单的状态机（`inWord` 布尔标志）。当从非单词状态（空白字符或输入开始）转换到单词状态（非空白字符）时，计数一个单词。使用 `unicode.IsSpace` 来正确识别各种 Unicode 空白字符，确保超越基本 ASCII 空格和制表符的准确性。
4.  **最小化内存分配 (Minimal Allocations)**: 设计上力求在主处理循环中最小化内存分配，以减少垃圾回收 (GC) 的压力。主要的缓冲区在多次读取之间被复用。

## 安装

1.  **确保已安装 Go**: 你的系统需要安装 Go (推荐 1.16 或更高版本)。你可以从 [golang.google.cn](https://golang.google.cn/dl/) (国内镜像) 或 [golang.org](https://golang.org/dl/) 下载。
2.  **从源码构建**:
    ```bash
    # 克隆仓库 (或者直接保存 gowc.go 文件)
    # git clone <repository-url>
    # cd <repository-directory>

    # 构建可执行文件
    go build -o gowc main.go

    # (可选) 将可执行文件移动到你的 PATH 路径下的目录中，以便全局调用
    # sudo mv gowc /usr/local/bin/
    ```

## 使用说明

用法: gowc [-clw] [文件 ...]

为每个 文件 打印换行符数、单词数和字节数统计，
如果指定了多个 文件，则额外输出一个总计行。
当没有 文件，或者 文件 为 - 时，读取标准输入。

选项:
-c 打印字节数统计
-l 打印换行符数统计 (即行数)
-w 打印单词数统计

*   如果没有指定任何选项 (`-c`, `-l`, `-w`)，默认行为是 `-lwc` (打印行数、单词数和字节数)。
*   `文件` 参数可以是文件的路径。
*   使用 `-` 作为文件参数，表示在该位置显式地从标准输入读取。
*   如果没有提供文件参数，`gowc` 会从标准输入读取。

### 使用示例

1.  **统计单个文件的行数、单词数和字节数：**
    ```bash
    gowc report.txt
    # 输出: (例如)       15      310     1850 report.txt
    ```

2.  **仅统计文件的行数：**
    ```bash
    gowc -l report.txt
    # 输出: (例如)       15 report.txt
    ```

3.  **统计多个文件的单词数和字节数，并显示总计：**
    ```bash
    gowc -wc notes.md main.go
    # 输出: (例如)
    #          50      250 notes.md
    #         120     3500 main.go
    #         170     3750 total
    ```

4.  **通过管道统计标准输入的行数：**
    ```bash
    cat access.log | gowc -l
    # 输出: (例如)   105321
    ```

5.  **通过重定向统计标准输入的单词数：**
    ```bash
    gowc -w < chapter1.txt
    # 输出: (例如)     5820
    ```

6.  **先统计一个文件的字节数，然后统计标准输入的字节数：**
    ```bash
    gowc -c config.yaml - < user_input.txt
    # 输出: (例如)
    #        1024 config.yaml
    #         512 -          <-- 注意: 对于通过 '-' 读取的标准输入，不显示文件名
    #        1536 total
    ```

## 未来工作 / TODO

*   **实现 `-m` (字符数统计)**: 增加对多字节字符（如 UTF-8）的正确计数支持，这与字节数 (`-c`) 不同。需要进行 UTF-8 解码。
*   **实现 `-L` (最长行长度)**: 增加查找并打印最长行的长度的功能。
*   **多文件并发处理**: 探索使用 Go 协程 (goroutine) 并发处理多个文件。这可能在处理大量文件时提高速度，尤其是在多核系统上（尽管磁盘 I/O 仍可能是瓶颈）。需要仔细进行基准测试。
*   **更严格的基准测试**: 与系统自带的 `wc` 以及其他实现进行更详细的性能比较，涵盖不同大小和类型的文件。
*   **配置选项**: 考虑增加用于调整缓冲区大小或其他调优参数的标志（主要用于实验目的）。
*   **增强测试**: 添加更全面的单元测试和集成测试，覆盖边缘情况和不同的输入类型。
